<!--
Developed by Timba Software Corp. www.timbasoftware.com admin@timbasoftware.com
This page lists plans
@author Alvaro Scuccimarra <ascuccimarra@timbasoftware.com>
-->
<apex:page id="XactlySMBCalculateManagePayments" controller="XactlyExpress.XactlySMBCalculateManagePayments" sidebar="false" showHeader="false" standardStylesheets="false" action="{!redirectWhenAccessIsDenied}">
    <c:XactlySMBCursor />
    <title>{!$Label.Calculate}: {!$Label.CalculateWizardStep5}</title>
    <!-- PAGE WRAPPER --> 
    <div class="pageContent" id="pContent" style="overflow: visible;">
            <!-- HEADER -->
            <apex:form id="theForm" >
            <apex:outputPanel layout="block" styleClass="header">
                <c:XactlySMBHeader id="XactlySMBHeader" isAdmin="{!isAdmin}" isActive="{!isActive}" nbrSeparator="{!nbrSeparator}" nbrDecimal="{!nbrDecimal}" currentUserOrSlected="{!currentUserOrSlected}" emulatingUserURLAppend="{!emulatingUserURLAppend}" wqlabel="{!currentSettings.quotasPluralCap}" wclabel="{!currentSettings.creditsPluralCap}" wlabel="{!currentSettings.dealsPluralCap}" wtype="calculate" step="5" hlabel="{!$Label.xactlyexpress__ReviewEditPaymentsDrill}" stepHelp="CalculateManagePayments" showPrevious="true" showNext="true" showSave="false" showRefresh="false" showExport="false" selected="1" selectedLevel2="4" selectedLevel3="2" />
            </apex:outputPanel> 

            <div class="error">
            <!-- INSUFFICIENT PERMISSIONS -->
                <apex:outputPanel rendered="{!!isAdmin || !isActive}">
                    <c:XactlySMBErrorMsg error="{!$Label.xactlyexpress__InsufficientPermissions}" />
                </apex:outputPanel>
            </div>
            
            <!--this link open 'customize view light box' -->
           <a class="openSplitPopup" id="openSplitPopupBtn" rel="superbox[iframe#split.xactlySuperBox][1100x800]" href="{!$Page.XactlySMBColumnsPaymentsToShowPopup}"> </a>
            <div id="shadowContainer" class="shadowContainer">
            
            <apex:outputPanel layout="block" id="chatter" styleclass="additionalContent" rendered="{!isAdmin && isActive}">  
                <c:XactlySMBChatterWall objectId="{!$User.Id}" showHeader="true" showWall="true" currentPage="{!$CurrentPage.Name}" chatterCurrentUserImageUrl="{!chatterCurrentUser_ImageUrl}" rendered="{!isChatterEnabled && isChatterLoaded}"/>
            </apex:outputPanel>
            
            <!-- MAIN CONTENT -->
            <apex:outputPanel id="mainContentDiv" style="padding-top:20px;" layout="block" styleClass="mainContent" rendered="{!isAdmin && isActive}" >
                <!-- CONTENT -->
                <apex:outputPanel layout="block" styleClass="content" style="width:100%;height:100%;">                           
                    <div id="mainScreen" style="margin-left:35px;">
                        
                        <!-- TOP SIDE -->
                        <apex:outputPanel layout="block" style="width:1000px;" styleClass="leftSidePanel" id="leftSidePanel">
                            <div style="padding:5px;" id="mainCornerDiv" class="mainCornerDiv tableWrapper">
                                <apex:outputPanel rendered="{!IF(filters.size>0,'false','true')}" layout="block" id="dropdownsFilter" styleclass="dropdownsFilter" style="float:left">
                                    <apex:outputText value="{!$Label.xactlyexpress__selectView}" styleClass="areaTitle"/>
                                    <apex:selectList id="fyscalYearList" value="{!crrntFiscalYearId}" size="1" multiSelect="false" onchange="waitOn();closeDetailsNoRefresh();reloadDropDownsFiscalYear();" style="margin-left:4px;">
                                        <apex:selectOptions value="{!fiscalYearOptions}"/>
                                    </apex:selectList>  
                                    
                                    <apex:selectList id="periodList" value="{!crrntPeriodId}" size="1" multiSelect="false" onchange="waitOn();closeDetailsNoRefresh();reloadDropDownsPeriods();" style="margin-left:4px;">
                                        <apex:selectOptions value="{!periodOptions}"/>
                                    </apex:selectList>
                                    
                                    <apex:selectList id="planSelList" value="{!crrntPlanId}" size="1" multiSelect="false" onchange="waitOn();closeDetailsNoRefresh();reloadDropDownsPlan();" style="margin-left:4px;width:200px;" styleClass="needTitle">
                                        <apex:selectOptions value="{!planOptions}"/>
                                    </apex:selectList>  
                                    <apex:selectList id="userList" value="{!crrntUserId}"  size="1" multiSelect="false" onchange="waitOn();closeDetailsNoRefresh();reloadAll();" style="margin-left:4px;">
                                        <apex:selectOptions value="{!salesPersonsOptions}"/>
                                    </apex:selectList>
                                </apex:outputPanel>
                                <div style="float:left;margin-top:2px;margin-left:10px;width:{!IF(filters.size>0,'750','300')}px;" class="btnsContainer">
                                    <div class="separateBtn btnToLeft btnAction">
                                    <div class="xactlyBtnRectWrapper enable" onmouseover="xactlyBtnRectMouseOver(this);" onmouseout="xactlyBtnRectMouseOut(this);" onClick="showFiltersOnDemand();" style="float:left;margin-left:10px;margin-right:20px;margin-top:-4px;">
                                                                        <div class="xactlyBtnRect">
                                                                            <div class="xactlyBtnRectBackground">
                                                                                <div class="middleOffMouse xactlyBtnRectMiddle" >
                                                                                    <div class="rigthOffMouseBtn xactlyBtnRectRight" >
                                                                                        <div class="xactlyBtnRectTextWrapper xactlyBtnRectLabel"> {!$Label.CreateFilter}</div>
                                                                                    </div>
                                                                                </div>     
                                                                          </div>
                                                                        </div>
                                                                </div> 
                                        
                                    </div>
                                    <div class="separateBtn btnToLeft btnAction">
                                       
                                           <div class="xactlyBtnRectWrapper enable" onclick="waitOn();closeDetails();resetFiltersAF();" onmouseover="xactlyBtnRectMouseOver(this);" onmouseout="xactlyBtnRectMouseOut(this);" style="float:left;margin-left:10px;margin-right:20px;margin-top:-4px;">
                                                                        <div class="xactlyBtnRect">
                                                                            <div class="xactlyBtnRectBackground">
                                                                                <div class="middleOffMouse xactlyBtnRectMiddle" >
                                                                                    <div class="rigthOffMouseBtn xactlyBtnRectRight" >
                                                                                        <div class="xactlyBtnRectTextWrapper xactlyBtnRectLabel">{!$Label.ResetFilter}</div>
                                                                                    </div>
                                                                                </div>     
                                                                          </div>
                                                                        </div>
                                                                </div> 
                                                     
                                        
                                    </div> 
                                    <div class="separateBtn btnToLeft btnAction">
                                        
                                          <div class="xactlyBtnRectWrapper enable AUTOM_CustomizeView" onclick="jQuery('#openSplitPopupBtn').click();" onmouseover="xactlyBtnRectMouseOver(this);" onmouseout="xactlyBtnRectMouseOut(this);" style="float:left;margin-left:10px;margin-right:20px;margin-top:-4px;">
                                                                        <div class="xactlyBtnRect">
                                                                            <div class="xactlyBtnRectBackground">
                                                                                <div class="middleOffMouse xactlyBtnRectMiddle" >
                                                                                    <div class="rigthOffMouseBtn xactlyBtnRectRight" >
                                                                                        <div class="xactlyBtnRectTextWrapper xactlyBtnRectLabel"><apex:outputtext value="{!$Label.xactlyexpress__customizeView}"/></div>
                                                                                    </div>
                                                                                </div>     
                                                                          </div>
                                                                        </div>
                                                                </div> 
                                        
                                    </div>
                                    <apex:outputPanel styleClass="textFilter" rendered="{!IF(filters.size>0,'true','false')}">{!IF(currentFilterText!=null,'['+currentFilterText+']','')}</apex:outputPanel>
                                </div> 
                                <div style="clear:both;"></div>
                                <div class="tHeader" style="margin-top:6px;">
                                    <div style="background-image: url('{!URLFOR($Resource.XactlySMBResources ,'img/layout/topBgTable.png')}');margin-left:5px;margin-right:3px;height:36px;">
                                        <div style="float: left;margin-left:-5px;"><img class="img-topLeftCurvy" src="{!URLFOR($Resource.XactlySMBResources ,'img/layout/topLeftCurvy.png')}"/></div>
                                        <div style="float: right;margin-right:-5px;"><img class="img-topRightCurvy" src="{!URLFOR($Resource.XactlySMBResources ,'img/layout/topRightCurvy.png')}"/></div>
                                        <div style="clear:both"></div>
                                    </div> 
                                </div>
                                <apex:outputPanel styleClass="tContent" layout="block" rendered="{!IF(PaymentRowsSize==0,true,false)}" style="margin-bottom:30px;margin-top:30px;">
                                    {!$Label.xactlyexpress__noRowsFilters}
                                </apex:outputPanel>
                                <apex:outputPanel styleClass="tContent" layout="block" rendered="{!IF(PaymentRowsSize!=0,true,false)}">
                                    <div style="width:100%;overflow:hidden" id="mainDiv" class="mainDiv">                 
                                     
                                        <apex:inputHidden id="measureResultId" value="{!measureResultId}" />
                                        <apex:inputHidden id="planMeasureResultId" value="{!planMeasureResultId}" />
                                        <apex:inputHidden id="toCommentMeasureId" value="{!toCommentMeasureId}" />
                                        <apex:inputHidden id="selectedPaymentRow" value="{!selectedPaymentRow}" />
                                        <apex:inputHidden id="selectedRowAfterRerender" value="{!selectedRowAfterRerender}" />
                                        
                                         <!-- Top Panel -->
                                        <apex:outputPanel id="tableContainer" styleClass="tableContainer" layout="block">            
                                            <div class="FixedCelsTable">
                                               <div class="tablesHolder">
                                                   <div id="scroller" class="scroller" onscroll="scrollContent();" style="display: none;"><div id="scrollCont">&nbsp;</div></div>
                                                   
                                                   <apex:outputPanel id="FixedCelsTableGrid">
                            
                                                       <div id="recordsList" class="recordsList">
                                                           <div id="colsContainer" class="colsContainer">
                                                               <div id="cols"  class="columns">
                                 <!-- tcont no cellsTable -->      <table id="tcont" class="payTable" cellspacing="0" border="0" style="margin-top: 0px;">
                                                                        <tr style="background-color:#F4F8FB;">
                                                                            <td width="20px"><div style="width:27px;">&nbsp;</div></td>
                                                                            <apex:repeat var="iter" value="{!columnList}" id="headerGenerator">
                                                                                <apex:outputpanel rendered="{!IF(iter.display, true, false)}" layout="none">
                                                                                    <td style="white-space:nowrap;">
                                                                                        <div style="width:100%">  
                                                                                            <apex:outputPanel rendered="{!IF(sortBy == iter.id, true, false)}" style="float:left;width:10px!important;_display: inline;_width:11px;margin-top:4px;margin-right:4px;margin-left:1px">
                                                                                              <div class="inteactionIconSprite {!IF(sortByDesc == true,'arrowDown','arrowUp')}" style="_width:11px;"></div>
                                                                                            </apex:outputPanel>
                                                                                            <apex:commandLink id="headerLinks" onclick="if (!checkOpen()) return false;" oncomplete="initSuperbox();fixCelsDimensions();selectCurrent();waitOff();adjustBorder();" value="{!iter.name}" action="{!sortPaymentList}" rerender="leftSidePanel" styleclass="areaTitle">
                                                                                                <apex:param name="sb" value="{!iter.id}"/>
                                                                                            </apex:commandLink>
                                                                                        </div>  
                                                                                    </td>
                                                                                </apex:outputpanel>
                                                                            </apex:repeat>
                                                                         </tr>
                                                                    </table>
                                                               </div>
                                                           </div>
                                                           
                                                           <!-- Cells Panel -->
                                                           <div id="cellContainer" class="cellContainer">
                                                               <div id="cells" class="cells">
                                                                   <table id="paymentsTable" cellspacing="0" border="0">
                                                                   	   <apex:variable var="index" value="{!0}"/>
                                                                       <apex:repeat value="{!paymentRows}" var="p"> 
                                                                           <tr class="{!IF(MOD(p.i,2) == 0, 'odd', 'even')} {!IF(p.m.id == measureResultId, 'needSelected', '')} {!IF(p.i == selectedRowAfterRerender,'selectedRowTable','')} CPaymentRow-{!p.m.id}" id="paymentsRow_{!p.i}">
                                                                               <td width="20px"> 
                                                                                   <div style="width:27px;" onclick="commentMeasure({!index})">
                                                                                       <apex:outputPanel id="commentIconWrapper">
                                                                                            <div class="{!IF(OR(AND(ISNULL(p.m.Comment__c),ISNULL(p.m.Comment2__c)),AND((p.m.Comment__c==''),(p.m.Comment2__c==''))),'inteactionIconSprite addCommentLink','inteactionIconSprite editCommentLink')}" >&nbsp;</div>
                                                                                       </apex:outputPanel>
                                                                                   </div>
                                                                               </td>  
                                                                               <apex:repeat var="iter" value="{!p.valueList}">
                                                                                        <apex:outputpanel rendered="{!(iter.name==$Label.xactlyexpress__LastName || iter.name==$Label.xactlyexpress__FirstName) && iter.display}" layout="none">
                                                                                            <td onclick="OpenningUser('{!p.m.ProfilePlanID__r.ProfileID__r.XactlyExpress__UserID__c}')" style="cursor:pointer;color:#396F90;"><div style="width:100%"><c:XactlySMBLongTextBubble text="{!iter.value}" maxLength="23" /></div></td>
                                                                                        </apex:outputpanel>
                                                                                        <apex:outputpanel rendered="{!IF(iter.display && not(iter.name==$Label.xactlyexpress__LastName || iter.name==$Label.xactlyexpress__FirstName), true, false)}" layout="none">
                                                                                            <td onclick="loadDetail(this,'{!p.m.id}','{!$Component.measureResultId}','{!p.m.ProfilePlanID__r.XactlyExpress__PlanID__c}','{!$Component.planMeasureResultId}');"><div style="width:100%"><c:XactlySMBLongTextBubble text="{!iter.value}" maxLength="23" /></div></td>
                                                                                       </apex:outputpanel>
                                                                               </apex:repeat>
                                                                           </tr>
                                                                         <apex:variable var="index" value="{!index + 1}"/>
                                                                       </apex:repeat>
                                                                       <tr style="background-color:#EFEFEF;{!IF(footerList.size == 0,'display:none;','')}" class="CPaymentTotal">
                                                                           <td colspan="1" style="border:0px;cursor: default;">{!$Label.xactlyexpress__Total}</td>
                                                                           <apex:repeat var="iter" value="{!footerList}">
                                                                                <apex:outputpanel rendered="{!IF(iter.display, true, false)}" layout="none"><td style="border:0px;cursor: default;white-space: nowrap"><div style="width:100%">{!iter.value}</div></td></apex:outputpanel>
                                                                           </apex:repeat>
                                                                        </tr>
                                                                   </table>
                                                               </div>
                                                           </div>
                                                       </div>
                                                   </apex:outputPanel>
                                               </div>
                                           </div>
                                       </apex:outputPanel>
                                    </div>                   
                                </apex:outputPanel>

                                <apex:inputHidden id="currentPage" value="{!currentPage}"/>
                                <apex:inputHidden id="numPages" value="{!numPages}"/>
                                <div class="tFooter">
                                    <div class="footerLeftSide">
                                        <c:XactlySMBMessageBox msg="{!msgLimitAlertGeneral}" />
                                    </div>
                                    <apex:outputPanel id="prevnextarrows" styleClass="prevNextWrapp">                                           
                                            <apex:outputPanel layout="none" rendered="{!currentPage > 1}">
                                             <div id="btnFirstButton" onclick="jQuery('input[id$=currentPage]').val(1);waitOn();goToPage()">
                                                <div class="inteactionIconSprite btnFirstPagebk" style="margin-left:0px;"></div>
                                             </div>
                                             <div id="btnPrevPageButton" onclick="jQuery('input[id$=currentPage]').val(jQuery('input[id$=currentPage]').val()==1?1:parseInt(jQuery('input[id$=currentPage]').val())-1);waitOn();goToPage()">
                                                <div class="inteactionIconSprite btnPrevPagebk"></div>
                                             </div>
                                              &nbsp;<apex:outputText value="{!$Label.xactlyexpress__Previous}" style="color:#404040;margin-left: -25px;"/>&nbsp;
                                            </apex:outputPanel>
                                            <apex:outputPanel layout="none" rendered="{!currentPage == 1}">
                                                <div class="inteactionIconSprite btnFirstPage" style="margin-left:0px;"></div>
                                                <div class="inteactionIconSprite btnPrevPage"></div>&nbsp;<apex:outputText value="{!$Label.xactlyexpress__Previous}" style="color:#A8A8A8;"/>&nbsp;
                                            </apex:outputPanel>
                                            <apex:outputPanel layout="none" rendered="{!currentPage < numPages}">
                                            <apex:outputText value="{!$Label.xactlyexpress__Next}" style="color:#404040;"/>&nbsp;
                                                 <div id="btnLastPageButton" onclick="jQuery('input[id$=currentPage]').val({!numPages});waitOn();goToPage()">
                                                   <div class="inteactionIconSprite btnLastPagebk"></div>
                                               </div>
                                                <div id="btnNextPageButton" onclick="jQuery('input[id$=currentPage]').val(jQuery('input[id$=currentPage]').val()=={!numPages}?{!numPages}:parseInt(jQuery('input[id$=currentPage]').val())+1);waitOn();goToPage()" >
                                                    <div class="inteactionIconSprite btnNextPagebk" ></div> 
                                                </div>
                                            </apex:outputPanel>
                                            <apex:outputPanel layout="none" rendered="{!currentPage == numPages}">
                                                <apex:outputText value="{!$Label.xactlyexpress__Next}" style="color:#A8A8A8;"/>&nbsp;
                                                     <div class="inteactionIconSprite btnLastPage "></div>
                                                     <div class="inteactionIconSprite btnNextPage"></div>
                                            </apex:outputPanel>
                                                          
                                    </apex:outputPanel>
                                    <apex:outputPanel styleclass="footerRightSide" id="paginator">                            
                                        <apex:outputText value="{!$Label.xactlyexpress__Page}"/>&nbsp;<input type="Text" class="noCompare" value="{!currentPage}" onblur="MoveIfNeeded(this.value);" style="width:16px;"/>&nbsp;<apex:outputText value="{!$Label.xactlyexpress__Of}"/>&nbsp;<apex:outputText value="{!numPages}"/>
                                    </apex:outputPanel>
                                </div>
                                <center> 
                                    <apex:outputPanel layout="block" id="commentBox" style="display:none;">
                                        <apex:inputHidden id="public_comment" value="{!oldPublicComment}" />
                                        <apex:inputHidden id="private_comment" value="{!oldPrivateComment}" />
                                        
                                    </apex:outputPanel>
                                 </center>
                            </div> 
                        </apex:outputPanel>
                       
                        <!-- BOTTOM SIDE -->
                        
                        <apex:outputPanel id="DetailBoxWrapper">
                        <input type="hidden" id="DetailBoxLoaded" value="{!showDetailBox}" /> 
                        <apex:outputPanel rendered="{!showDetailBox}">
                        <apex:outputPanel id="detailBox">
                        <div id="dragBar" style="display:inline;width:1000px;{!IF(OR(ISNULL(selectedRowAfterRerender),selectedRowAfterRerender == 0),'display:none;','')}"> 
	                              <div style="float:right; margin-right: 16px;">
	                                  <div class="xactlyBtnRectWrapper enable" onmouseover="xactlyBtnRectMouseOver(this);" onmouseout="xactlyBtnRectMouseOut(this);" onclick="closeDetails();" style="float:left;margin-left:16px;margin-right:30px;">
	                                      <div class="xactlyBtnRect">
	                                          <div class="xactlyBtnRectBackground">
	                                              <div class="middleOffMouse xactlyBtnRectMiddle" >
	                                                  <div class="rigthOffMouseBtn xactlyBtnRectRight" >
	                                                        <div class="xactlyBtnRectTextWrapper xactlyBtnRectLabel">&gt;&gt;</div>
	                                                   </div>
	                                              </div>     
	                                          </div>
	                                      </div>
	                                 </div>
	                               </div>           
	                          <div style="float:right;margin-top:3px;" class="areaTitle">{!$Label.closeDetails}</div><br/><br/>
	                      </div>
                        <div id="rightSidePanel" class="detailDiv" style="margin-bottom:70px;width:1000px;margin-top:-25px;{!IF(OR(ISNULL(selectedRowAfterRerender),selectedRowAfterRerender == 0),'display:none;','')}">
                            <div id="detailCornerDiv" class="detailCornerDiv" style="width:980px;margin-top:30px; padding:10px">
                               <apex:outputPanel layout="block" style="*margin-top:10px;*margin-top:15px;">
                                    <div style="width:980px;height:20px">
                                        <div style="width:40%; color:#FFFFFF; font-weight:bold; margin-top:3px; float:left;font-size:10pt;">
                                            {!$Label.paymentDetails}
                                        </div>
                                        <div style="width:60%; color:#FFFFFF; font-weight:bold; margin-top:3px; float:right;text-align:right;font-size:10pt;">
                                            {!lastCalculatedPlan} - {!$Label.LastCalculation}: {!lastCalculatedDate} 
                                        </div>
                                    </div>
                                    <apex:outputPanel id="tableContainer2" styleClass="tableContainer2" layout="block">                                             
                                        <div class="FixedCelsTable2">
                                           <div class="tablesHolder2">
                                               
                                               <apex:outputPanel id="FixedCelsTableGrid2">
                        
                                                   <div id="recordsList2" class="recordsList2">
                                                       <div id="colsContainer2" class="colsContainer2">
                                                           
                                                           <!-- Cells Panel -->
                                                           <div id="cellContainer2" class="cellContainer2" >
                                                           
                                                               <div id="cells2" class="cells2">
                                                                   <table id="paymentsTable2" cellspacing="0" border="0">
                                                                   
                                                                   <tr style="background-color:#CECECE;">
                                                                       <td class="cell_header_table_2"><div style="cursor:pointer;color:#396F90;" onclick="OpenningUser('{!JSENCODE(currentUserId)}');">{!currentProfilePeriod}</div></td>
                                                                       <apex:outputPanel layout="none" rendered="{!withCurrency}">
                                                                            <td class="cell_header_table_2"><div>{!$Label.xactlyexpress__Currency}</div></td>
                                                                       </apex:outputPanel>                                                                       
                                                                       <td class="cell_header_table_2"><div>{!$Label.Payment}</div></td>
                                                                       <td class="cell_header_table_2"><div>
                                                                            <apex:outputText value="{!$Label.xactlyexpress__EarnedValue}">
                                                                                <apex:param value="{!currentSettings.EarnedPluralCap}"/>
                                                                            </apex:outputText>
                                                                        </div></td>
                                                                       <td class="cell_header_table_2"><div>{!$Label.Held}</div></td>
                                                                       <td class="cell_header_table_2"><div>{!$Label.Released}</div></td>
                                                                       <td class="cell_header_table_2"><div>{!$Label.HoldBalance}</div></td>
                                                                       <td class="cell_header_table_2"><div>{!$Label.currentAtt}</div></td>
                                                                       <td class="cell_header_table_2"><div>{!QuotaAtt}</div></td>
                                                                       <td class="cell_header_table_2"><div>{!Quota}</div></td>
                                                                       <td class="cell_header_table_2"><div>{!$Label.percentAttain}</div></td>
                                                                   </tr>
                                                                   
                                                                       <tr class="odd">
                                                                           <td><div style="width:100%;">{!title}</div></td>
                                                                           <apex:outputPanel layout="none" rendered="{!withCurrency}">
                                                                                <td><div style="width:100%;">&nbsp;</div></td>
                                                                           </apex:outputPanel>
                                                                           <td><div style="width:100%;">&nbsp;</div></td>
                                                                           <td><div style="width:100%;">&nbsp;</div></td>
                                                                           <td><div style="width:100%;">&nbsp;</div></td>
                                                                           <td><div style="width:100%;">&nbsp;</div></td>
                                                                           <td><div style="width:100%;">&nbsp;</div></td>
                                                                           <td><div style="width:100%;">&nbsp;</div></td>
                                                                           <td><div style="width:100%;">&nbsp;</div></td>
                                                                           <td><div style="width:100%;">&nbsp;</div></td>
                                                                           <td><div style="width:100%;">&nbsp;</div></td>
                                                                       </tr>
                                                                       <tr class="even">
                                                                           <td><div style="width:100%;">{!$Label.TotalPayout}</div></td>
                                                                           <apex:outputPanel layout="none" rendered="{!withCurrency}">
                                                                                <td><div style="width:100%;">{!ptn.currencyiso}</div></td>
                                                                           </apex:outputPanel>
                                                                           <td class="rightAligned"><div style="width:100%;">{!ptn.paymentS}</div></td>
                                                                           <td class="rightAligned"><div style="width:100%;">{!ptn.earnedS}</div></td>
                                                                           <td class="rightAligned"><div style="width:100%;">{!ptn.HeldS}</div></td>
                                                                           <td class="rightAligned"><div style="width:100%;">{!ptn.ReleasedS}</div></td>
                                                                           <td class="rightAligned"><div style="width:100%;">{!ptn.BalanceS}</div></td>
                                                                           <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                           <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                           <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                           <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                       </tr>
                                                                       
                                                                       <apex:repeat value="{!ptn.ptnl}" var="planNode">
                                                                       
                                                                       
                                                                           <tr id="collapse{!planNode.Id}">
                                                                               <td>
                                                                                   <div class="{!IF(planNode.planId == planMeasureResultId, 'collapseArrowDown', 'collapseArrowRight')}" style="width:90%" onclick="toggleCollapseTree(this);">
                                                                                       {!planNode.name}
                                                                                   </div>
                                                                               </td>
                                                                               <apex:outputPanel layout="none" rendered="{!withCurrency}">
                                                                                    <td><div style="width:100%;">{!planNode.currencyiso}</div></td>
                                                                               </apex:outputPanel>
                                                                               <td class="rightAligned"><div style="width:100%;">{!planNode.paymentS}</div></td>
                                                                               <td class="rightAligned"><div style="width:100%;">{!planNode.earnedS}</div></td>
                                                                               <td class="rightAligned"><div style="width:100%;">{!planNode.HeldS}</div></td>
                                                                               <td class="rightAligned"><div style="width:100%;">{!planNode.ReleasedS}</div></td>
                                                                               <td class="rightAligned"><div style="width:100%;">{!planNode.BalanceS}</div></td>
                                                                               <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                               <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                               <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                               <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                           </tr>
                                                                       
                                                                           <apex:repeat value="{!planNode.ptnl}" var="payrollCatNode">
                                                                           
                                                                               
                                                                               <tr id="collapse{!payrollCatNode.Id}" class="collapse{!planNode.Id}" style="{!IF(planNode.planId == planMeasureResultId, '', 'display:none;')}">
                                                                                   <td>
                                                                                       <div class="collapseArrowDown indent1" style="width:90%" onclick="toggleCollapseTree(this);">
                                                                                           {!payrollCatNode.name}
                                                                                       </div>
                                                                                   </td>
                                                                                   <apex:outputPanel layout="none" rendered="{!withCurrency}">
                                                                                        <td><div style="width:100%;">{!payrollCatNode.currencyiso}</div></td>
                                                                                   </apex:outputPanel>
                                                                                   <td class="rightAligned"><div style="width:100%;">{!payrollCatNode.paymentS}</div></td>
                                                                                   <td class="rightAligned"><div style="width:100%;">{!payrollCatNode.earnedS}</div></td>
                                                                                   <td class="rightAligned"><div style="width:100%;">{!payrollCatNode.HeldS}</div></td>
                                                                                   <td class="rightAligned"><div style="width:100%;">{!payrollCatNode.ReleasedS}</div></td>
                                                                                   <td class="rightAligned"><div style="width:100%;">{!payrollCatNode.BalanceS}</div></td>
                                                                                   <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                                   <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                                   <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                                   <td class="rightAligned"><div style="width:100%;">&nbsp;</div></td>
                                                                               </tr>
                                                                               
                                                                               <apex:repeat value="{!payrollCatNode.ptnl}" var="measureNode">
                                                                                                                                      
                                                                                   <tr style="{!IF(planNode.planId == planMeasureResultId, '', 'display:none;')}" id="collapse{!measureNode.Id}" class="collapse{!planNode.Id} collapse{!payrollCatNode.Id}">
                                                                                       <td class="firstCellWidthFixed" >
                                                                                           <div class="indent2" style="width:85%;">
                                                                                               {!measureNode.name}&nbsp; 
                                                                                               <!-- <a href="javascript: helpWindow = window.open('{!$Page.XactlySMBPaymentDetails}?mid={!measureNode.mrId}&prid={!measureNode.PeriodId}', 'Help','location=0,status=0,scrollbars=1,width=1000px,height=690px'); helpWindow.moveTo(100,100);"><img class="img-magnifyingTable" src="{!URLFOR($Resource.XactlySMBResources ,'img/icons/magnifying_table.PNG')}"/></a> -->
                                                                                           </div>
                                                                                       </td>
                                                                                       <apex:outputPanel layout="none" rendered="{!withCurrency}">
                                                                                            <td><div style="width:100%;white-space:nowrap;">{!measureNode.currencyiso}&nbsp;</div></td>
                                                                                       </apex:outputPanel>
                                                                                       <td class="rightAligned">
                                                                                           <div style="width:100%;white-space:nowrap;">
                                                                                               <apex:outputPanel styleClass="manualAdjustmentIndicator AUTOM-manualAdjustment" rendered="{!measureNode.hasManualAdj}">*</apex:outputPanel>
                                                                                               <a onClick="if('{!measureNode.ShowCalcAlert}'=='true'){alert('{!IF(isAdmin, calcErrorRepAdminLabel,calcErrorRepLabel)}');} else {helpWindow = window.open('{!$Page.XactlySMBPaymentDetails}?category=paid&usrId={!measureNode.UserId}&plnid={!measureNode.PlanId}&mid={!measureNode.MeasureId}&prid={!measureNode.PeriodId}', 'Help','location=0,status=0,scrollbars=1,width=1120px,height=690px,screenX=10,screenY=35,left=35,top=10');}" href="javascript:;">{!measureNode.paymentS}&nbsp;</a>
                                                                                           </div>
                                                                                       </td>
                                                                                       <td class="rightAligned">
                                                                                           <div style="width:100%;">
                                                                                               <a onClick="if('{!measureNode.ShowCalcAlert}'=='true'){alert('{!IF(isAdmin, calcErrorRepAdminLabel,calcErrorRepLabel)}');} else {helpWindow = window.open('{!$Page.XactlySMBPaymentDetails}?category=earned&usrId={!measureNode.UserId}&plnid={!measureNode.PlanId}&mid={!measureNode.MeasureId}&prid={!measureNode.PeriodId}', 'Help','location=0,status=0,scrollbars=1,width=1120px,height=690px,screenX=10,screenY=35,left=35,top=10');}" href="javascript:;">{!measureNode.earnedS}&nbsp;</a>
                                                                                           </div>
                                                                                       </td>
                                                                                       <td class="rightAligned">
                                                                                           <div style="width:100%;">
                                                                                               <a onClick="if('{!measureNode.ShowCalcAlert}'=='true'){alert('{!IF(isAdmin, calcErrorRepAdminLabel,calcErrorRepLabel)}');} else {helpWindow = window.open('{!$Page.XactlySMBPaymentDetails}?category=held&usrId={!measureNode.UserId}&plnid={!measureNode.PlanId}&mid={!measureNode.MeasureId}&prid={!measureNode.PeriodId}', 'Help','location=0,status=0,scrollbars=1,width=1120px,height=690px,screenX=10,screenY=35,left=35,top=10');}" href="javascript:;">{!measureNode.HeldS}&nbsp;</a>
                                                                                           </div>
                                                                                       </td>
                                                                                       <td class="rightAligned">
                                                                                           <div style="width:100%;">
                                                                                               <a onClick="if('{!measureNode.ShowCalcAlert}'=='true'){alert('{!IF(isAdmin, calcErrorRepAdminLabel,calcErrorRepLabel)}');} else {helpWindow = window.open('{!$Page.XactlySMBPaymentDetails}?category=released&usrId={!measureNode.UserId}&plnid={!measureNode.PlanId}&mid={!measureNode.MeasureId}&prid={!measureNode.PeriodId}', 'Help','location=0,status=0,scrollbars=1,width=1120px,height=690px,screenX=10,screenY=35,left=35,top=10');}" href="javascript:;">{!measureNode.ReleasedS}&nbsp;</a>
                                                                                           </div>                                                               
                                                                                       </td>
                                                                                       <td class="rightAligned">
                                                                                           <div style="width:100%;">
                                                                                               <a onClick="if('{!measureNode.ShowCalcAlert}'=='true'){alert('{!IF(isAdmin, calcErrorRepAdminLabel,calcErrorRepLabel)}');} else {helpWindow = window.open('{!$Page.XactlySMBPaymentDetails}?category=holdBalance&usrId={!measureNode.UserId}&plnid={!measureNode.PlanId}&mid={!measureNode.MeasureId}&prid={!measureNode.PeriodId}', 'Help','location=0,status=0,scrollbars=1,width=1120px,height=690px,screenX=10,screenY=35,left=35,top=10');}" href="javascript:;">{!measureNode.BalanceS}&nbsp;</a>
                                                                                           </div>
                                                                                       </td>
                                                                                       <td class="rightAligned"><div style="width:100%;"><a onClick="if('{!measureNode.ShowCalcAlert}'=='true'){alert('{!IF(isAdmin, calcErrorRepAdminLabel,calcErrorRepLabel)}');} else {helpWindow = window.open('{!$Page.XactlySMBCreditDetail}?category=none&usrId={!measureNode.UserId}&plnid={!measureNode.PlanId}&pid={!measureNode.MeasureId}&cid={!measureNode.creditId}&prid={!measureNode.PeriodId}', 'Credit_Detail','location=0,status=0,scrollbars=1,width=1100px,height=650px');}" href="javascript:;">{!measureNode.currentAttS}</a><apex:outputPanel layout="inline" style="color: red;" rendered="{!measureNode.hasCreditAdj}"  onmouseout="adjustmentBoxHide();" onmouseover="adjustmentBoxLaunch('credit:{!measureNode.mr.XactlyExpress__XCPeriod__c}:{!measureNode.mr.CreditResultID__r.XactlyExpress__CreditRuleID__c}:{!measureNode.mr.ProfilePlanId__r.XactlyExpress__ProfileID__c}:{!measureNode.mr.XactlyExpress__XCPeriod__c}');">*</apex:outputPanel>&nbsp;</div></td>
                                                                                       <td class="rightAligned"><div style="width:100%;">{!measureNode.quotaAttS}&nbsp;</div></td>
                                                                                       <td class="rightAligned"><div style="width:100%;">{!measureNode.QuotaS}&nbsp;</div></td>
                                                                                       <td class="rightAligned"><div style="width:100%;">{!measureNode.percentAttS}&nbsp;</div></td>
                                                                                   </tr>
                                                                                   
                                                                               </apex:repeat>                                              
                                                                           </apex:repeat>                                          
                                                                       </apex:repeat>                                          
                                                                   </table>
                                                               </div>
                                                           </div>
                                                       </div>
                                                   </div>
                                               </apex:outputPanel>
                                           </div>
                                        </div>      
                                    </apex:outputPanel>
                                    <div style="background:#FFFFFF;font-weight:bolder; padding:5px;color:#5D7C97; font-size:10pt">
                                        <a href="javascript:openPopup('{!JSENCODE(measureResultId)}');" style="color:#5D7C97;{!IF(mustShowAdjustmentPopup, '', 'display:none;')};">
                                            {!$Label.AdjustPayment}
                                        </a>
                                        <apex:outputPanel layout="none" rendered="{!currentSttgs.XactlyExpress__ProcessPayoutDetail__c}">
                                        &nbsp;|&nbsp;
                                        <a href="{!currentCommStmtUrl}" target="_blank" onclick="if({!IF(OR(currentCommStmtUrl='', mustRecalculate),true,false)}){if({!measureInLastPeriod}){alert('{!commStmtnotAvlbltoClosePeriodLabel}');return false;}else{alert('{!commnStmtnotAvlblLabel}');return false;}}" style="color:#5D7C97;">
                                            {!commStmtLabel}
                                        </a>
                                        </apex:outputPanel>
                                        <apex:outputPanel layout="none" rendered="{!!currentSttgs.XactlyExpress__ProcessPayoutDetail__c}">
                                        &nbsp;|&nbsp;
                                        <a href="{!currentCommStmtUrl}" target="_blank" onclick="if({!IF(OR(currentCommStmtUrl='', mustRecalculate),true,false)}){alert('{!commnStmtnotAvlblLabel}');return false;}" style="color:#5D7C97;">
                                            {!$Label.viewDetailedCommissionStatement}
                                        </a>
                                        &nbsp;|&nbsp;
                                        <a href="{!$Page.XactlySMBCommStmt}?userId={!URLENCODE(currentUserId)}&prd={!URLENCODE(currentPeriodId)}&noDeals=1"  style="color:#5D7C97;" onClick="if ('{!showAlert}'=='true'){alert('{!IF(isAdmin, calcErrorRepAdminLabel,calcErrorRepLabel)}');return false;}">
                                            {!$Label.viewSummaryCommissionStatement}
                                        </a>
                                        </apex:outputPanel>
                                        &nbsp;|&nbsp;
                                        <a href="{!$Page.XactlySMBDashRepHome}?userId={!URLENCODE(currentUserId)}&prd={!URLENCODE(currentPeriodId)}" onclick="{!IF(ShowCurrentPeriodDashboard,'','shotAlertCurrentPeriodDashboard();return false;')}" style="color:#5D7C97;">
                                            {!$Label.ViewDashboard}
                                        </a>
                                    </div>
                               </apex:outputPanel>
                            </div>
                            
                        </div>
                        </apex:outputPanel>
                        </apex:outputPanel>
                        </apex:outputPanel><!-- End of DetailBoxWrapper -->
                        <div style="clear:both"></div>
                    </div> 
                    <!-- FILTERS -->
                    <apex:outputPanel id="FiltersWrapper">
                        <input type="hidden" id="FiltersLoaded" value="{!showFilters}" />
                        <apex:outputPanel rendered="{!showFilters}" layout="block" styleClass="idFilters">
                        
                        
                    <div id="filterScreen" style="width:850px; background:#F4F8FB; border: 3px solid #000000; padding:20px; top:30px; left:110px; position:absolute; z-index:3;{!IF(filterErrorMsg == '','display:none','')}">
                        <apex:outputPanel id="filtersContent">
                            <div id="currentFilterText" style="margin-left:100px; margin-bottom:20px; font-weight:bold">
                                {!currentFilterText}
                            </div>
                            <div id="filterErrorMsg" style="color:#FF0000;"><apex:outputText value="{!filterErrorMsg}" escape="false"/></div>                        
                            <div id="hideFilterButton" style="margin-left:15px;">
                                <span class="btnToCenter btnAction">
                                    <a href="javascript:toggleShowFilter();">
                                        <span class="rightBtnOrange">
                                            <span class="leftBtnOrange">
                                                <span class="middleBtnOrange">
                                                    {!$Label.HideFilter}
                                                </span>
                                            </span>
                                        </span>
                                    </a>           
                                </span>              
                            </div>
                            <div style="clear:both;"></div>
                            <div id="whiteBox" style="margin-bottom:50px;width:820px; padding:10px; margin-top:20px; margin-left:5px; border: 1px solid #AAAAAA; background:#FFFFFF;">
                                <div style="font-weight:bold;">
                                     <apex:outputText value="{!$Label.xactlyexpress__ShowMeAllPaymentsWhere}...">
                                      <apex:param value="payments" />
                               </apex:outputText> 
                               
                                    
                                </div>
                                <div id="questionMark" style="position;absolute; width:32px; height:32px; top:0px; right:0px">
                                
                                </div>
                                <div id="leftFilterBox" style="padding:20px; background: #F4F8FB; float:left; width:385px;">
                                   
                                      <apex:outputText value="{!$Label.xactlyexpress__FilterPayment}...">
                                      <apex:param value="payments" />
                               </apex:outputText> 
                                    
                                    <div id="leftBoxScroll" style="height:185px; overflow:auto;">                                    
                                        <table id="filtersTable" class="payTable">
                                            <apex:repeat value="{!filters}" id="repFilters" var="filter">
                                                <tr> 
                                                    <td>  
                                                        <apex:selectList id="filterFieldOps" value="{!filter.field}" multiSelect="false" size="1" onchange="changeFilterField(this);waitOn();">
                                                            <apex:selectOptions value="{!filterFieldOptions}" />
                                                        </apex:selectList>
                                                    </td>
                                                    <td>
                                                        <apex:outputPanel id="operatorOptions">
                                                            <apex:selectList id="filterOperatorOps" value="{!filter.operator}" multiSelect="false" size="1">
                                                                <apex:selectOptions value="{!filterOperatorOptions}" />
                                                            </apex:selectList>
                                                        </apex:outputPanel>
                                                    </td>
                                                    <td>                                                    
                                                        <apex:selectList id="filterValues" onchange="jQuery('.inputValue',this.parentNode).val(this.value);" value="{!filter.value}" multiSelect="false" size="1" style="{!IF(filter.field='XCPeriod__c','','display:none')}" styleclass="selectValue">
                                                            <apex:selectOptions value="{!filterPeriodOptions}" />
                                                        </apex:selectList>
                                                        <apex:selectList id="filterValuesCurrency" onchange="jQuery('.inputValue',this.parentNode).val(this.value);" value="{!filter.value}" multiSelect="false" size="1" style="{!IF(filter.field='CurrencyIsoCode','','display:none')}" styleclass="selectValueCurrency">
                                                            <apex:selectOptions value="{!allcurrencies}" />
                                                        </apex:selectList>
                                                        <apex:inputText id="filterValue" value="{!filter.value}" style="{!IF(filter.field='XCPeriod__c' || filter.field='CurrencyIsoCode','display:none','')}" styleclass="inputValue"/>
                                                    </td>
                                                    <td>
                                                        <apex:commandLink id="deleteFilter" styleclass="delete{!filter.i}" action="{!removeFilter}" rerender="filtersContent" oncomplete="loadBubbles();waitOff()">
                                                            <apex:param value="{!filter.i}" name="index"/>
                                                        </apex:commandLink>
                                                        <div class="inteactionIconSprite delete_small" onClick="waitOn();copyFilterValues();jQuery('.delete{!filter.i}').click()" style="cursor:pointer;"></div>
                                                        
                                                        <apex:actionFunction name="selectOperatorReload" action="{!selectOperatorReloadC}" rerender="operatorOptions" oncomplete="waitOff();">                        
                                                           <apex:param name="fieldValue" value="{!filter.field}" />
                                                        </apex:actionFunction> 
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                    </div>
                                    <div style="font-weight:bold; color:#446076;">
                                        <apex:commandLink id="addFilter" action="{!addFilter}" rerender="filtersContent" onclick="waitOn();copyFilterValues();" oncomplete="loadBubbles();waitOff();">
                                            {!$Label.AddAnotherFilter} &gt;&gt;
                                        </apex:commandLink>
                                    </div>                                
                                </div>
                                <div id="rightFilterBox">
                                
                                </div>      
                                <div style="clear:both;"></div>
                                <div id="filterButtons" style="margin-top:10px">
                                    <div class="btnToCenter btnAction">
                                        <span class="separateBtn">
                                            <a href="javascript:;" onclick="verifyFils();">
                                                <span class="rightBtnSilver">
                                                    <span class="leftBtnSilver">
                                                        <span class="middleBtnSilver">
                                                            {!$Label.ApplyChanges}
                                                        </span>
                                                    </span>
                                                </span> 
                                            </a>
                                        </span>
                                        <span class="separateBtn">
                                            <apex:commandLink id="discardFilter" action="{!discardFilters}" onclick="waitOn();" rerender="filtersContent" oncomplete="waitOff();loadBubbles();initSuperbox();">
                                                <span class="rightBtnSilver">
                                                    <span class="leftBtnSilver">
                                                        <span class="middleBtnSilver">
                                                            {!$Label.DiscardChanges}
                                                        </span>
                                                    </span>
                                                </span>
                                            </apex:commandLink>
                                        </span>  
                                        <span class="separateBtn">
                                            <apex:commandLink id="clearFilter" action="{!clearAllFilter}" onclick="waitOn();" rerender="filtersContent" oncomplete="waitOff();loadBubbles();storeValues();initSuperbox();">
                                                <span class="rightBtnSilver">
                                                    <span class="leftBtnSilver">
                                                        <span class="middleBtnSilver">
                                                            {!$Label.ClearFilters}
                                                        </span>
                                                    </span>
                                                </span>
                                            </apex:commandLink>
                                        </span>  
                                    </div>
                                </div> 
                                <div style="clear:both;"></div>  
                            </div>
                         </apex:outputPanel>                        
                    </div>
                        
                        
                        </apex:outputPanel>
                    </apex:outputPanel>
                    <!-- END FILTERS -->
                 </apex:outputPanel><!-- END CONTENT -->
             
                  
                <div style="clear:both"></div>
            </apex:outputPanel><!-- END CONTENTWRAPPER -->
            </div>
            
            <!-- FOOTER  -->
            <c:XactlySMBFooter isReadOnlyAdmin="{!isReadOnlyAdmin}" packageVersion="{!packageVersion}" showPrevious="true" showNext="true" showSave="false" showRefresh="false" showExport="false"/>
            <apex:actionFunction name="loadDetailBox" action="{!dummy}" oncomplete="loadDetail(cellRef,measureIDRef,objRef,PlanMeasureIDRef,obj2Ref);" rerender="DetailBoxWrapper">
                <apex:param assignTo="{!showDetailBox}" value="true" name="DetailBox" />
            </apex:actionFunction>
            <apex:actionFunction id="createFilter" action="{!refresh}" name="createFilterAF" rerender="filtersContent" oncomplete="waitOff();loadBubbles();"/>
            
            <apex:actionFunction name="reloadDropDownsFiscalYear" action="{!reloadDropDownsFiscalYear}" oncomplete="waitOff();reColourTableRows();fixCelsDimensions();resetCache();initSuperbox();" rerender="leftSidePanel,detailBox,DetailBoxWrapper"/>
            <apex:actionFunction name="reloadDropDownsPeriods" action="{!reloadDropDownsPeriods}" oncomplete="waitOff();reColourTableRows();fixCelsDimensions();resetCache();initSuperbox();" rerender="leftSidePanel,detailBox,DetailBoxWrapper"/>
            <apex:actionFunction name="reloadDropDownsPlan" action="{!reloadDropDownsPlan}" oncomplete="waitOff();reColourTableRows();fixCelsDimensions();resetCache();initSuperbox();" rerender="leftSidePanel,detailBox,DetailBoxWrapper"/>
            <apex:actionFunction name="reloadAll" action="{!applyFilter}" oncomplete="waitOff();reColourTableRows();fixCelsDimensions();resetCache();initSuperbox();" rerender="leftSidePanel,detailBox,DetailBoxWrapper"/>
            <apex:actionFunction name="refreshPage" action="{!refresh}" oncomplete="waitOff();reColourTableRows();fixCelsDimensions();resetCache();initSuperbox();" rerender="leftSidePanel,detailBox,DetailBoxWrapper"/>

            <apex:actionfunction name="resetFiltersAF" action="{!resetFilters}" oncomplete="waitOff();fixCelsDimensions();storeValues();resetCache();initSuperbox();" rerender="leftSidePanel,detailBox,DetailBoxWrapper"/>
            <apex:actionFunction name="loadDetailAF" action="{!loadDetail}" rerender="tableContainer,detailBox" oncomplete="showDetails();loadDetailsOnComplete();loadBubbles();initSuperbox();"/>                       
            <apex:actionFunction name="commentMeasureAF" action="{!commentMeasure}" rerender="commentBox" oncomplete="commentMeasureOnComplete();loadBubbles();initSuperbox();"/>

            <apex:actionFunction name="goToPageAF" action="{!goToPage}" oncomplete="waitOff();reColourTableRows();fixCelsDimensions();resetCache();initSuperbox();" rerender="leftSidePanel,detailBox,DetailBoxWrapper"/>
            <apex:actionFunction name="refreshAll" action="{!refreshTables}"/>
            
            <apex:actionFunction name="closeCommentAF" action="{!closeComment}"  rerender="leftSidePanel" oncomplete="loadBubbles();fixCelsDimensions();closeCommentOnComplete();initSuperbox();" />            
            <apex:actionFunction name="closeComment" action="{!closeComment}"  rerender="leftSidePanel, commentBox" oncomplete="loadBubbles();fixCelsDimensions();closeCommentOnComplete();introAsTab();initSuperbox();" />              
            <apex:actionFunction name="saveComment" action="{!saveComment}"  rerender="commentIconWrapper" oncomplete="waitOff();"/>                             

            <apex:actionfunction name="applyFiltersAF" action="{!goToFirstPage}" rerender="leftSidePanel, filtersContent" oncomplete="waitOff();rerenderNoCompare=true;{!IF(continueFiltering, 'toggleShowFilter();', '')};fixCelsDimensions();resetCache();initSuperbox();"/>
        
            <apex:actionFunction name="loadFilters" action="{!dummy}" oncomplete="completeLoadFilters();" rerender="FiltersWrapper">
                <apex:param assignTo="{!showFilters}" value="true" name="Filters" />
            </apex:actionFunction>
            
            <apex:actionfunction id="chatterLoader" name="loadChatter" action="{!loadChatter}" rerender="chatter" oncomplete="waitOff();initChatter();jQuery('.innerOcultar a').click();"/>
            
        </apex:form>
    </div>
    
    <div id="cacheDetailContainer"></div>
    
    <input class="hidden" id="url_calculate_manage_att" value="{!$Page.XactlySMBCalculateManageAttainments}" />
    <input class="hidden" id="url_calculate_manage_pay_mhr" value="{!$Page.XactlySMBCalculateManagePaymentsMHR}" />
    <input class="hidden" id="url_calculate_adjust_pay_pop" value="{!$Page.XactlySMBCalculateAdjustPayPopup}" />
    <input class="hidden" id="label_calculate_wizard_step_5" value="{!JSENCODE($Label.CalculateWizardStep5)}" />
    <input class="hidden" id="label_adjust_pay" value="{!JSENCODE($Label.AdjustPayment)}" />
    <input class="hidden" id="label_filter_value_cant_be_empty" value="{!JSENCODE($Label.FilterValueCantBeEmpty)}" />
    <input class="hidden" id="label_cant_see_current_period_dashboard" value="{!$Label.cantSeeCurrentPeriodDashboard}" />
    
    <c:XactlySMBFooterScript isChatterEnabled="{!isChatterEnabled}" loadPerformantJs="true" loadHeaderJs="true" />
    <apex:stylesheet value="{!URLFOR($Resource.XactlyExpress__XactlySMBResources ,'pages/css/XactlySMBCalculateManagePayments.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.XactlyExpress__XactlySMBResources ,'components/css/XactlySMBShowAdjustments.css')}" />
    <script type="text/javascript" language="javascript" src="{!URLFOR($Resource.XactlySMBResources, 'pages/js/XactlySMBCalculateManagePayments.js')}"></script>
    <script type="text/javascript" language="javascript" src="{!URLFOR($Resource.XactlySMBResources, 'components/js/XactlySMBShowAdjustments.js')}"></script>
    <c:XactlySMBFeedbackTab />
    <c:XactlySMBComments publicCommentEnabled="true" privateCommentEnabled="true" readOnlyPublic="{!IF(!isReadOnlyAdmin,false,true)}" readOnlyPrivate="{!IF(!isReadOnlyAdmin,false,true)}" />
    <c:XactlySMBShowAdjustments label_measure_result_details="{!$Label.xactlyexpress__Payment} {!$Label.xactlyexpress__Details}" label_liability_details="{!$Label.xactlyexpress__Liability} {!$Label.xactlyexpress__Details}" label_amount="{!$Label.xactlyexpress__Amount}" label_period="{!$Label.xactlyexpress__Period}" label_comment="{!$Label.xactlyexpress__CommentLabel}" label_total="{!$Label.xactlyexpress__Total}" label_payment_name="{!$Label.xactlyexpress__PaymentRuleName}" label_credit_name="{!creditRuleNameLabel}" label_manual_adjustment="{!$Label.xactlyexpress__CreditAdjustments}" label_close="{!$Label.xactlyexpress__Close}"/>
</apex:page>
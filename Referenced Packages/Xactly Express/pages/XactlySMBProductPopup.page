<apex:page controller="XactlyExpress.XactlySMBProductPopupController" showHeader="false" sidebar="false" action="{!redirectWhenAccessIsDenied}">
    <apex:stylesheet value="{!URLFOR($Resource.XactlyExpress__XactlySMBResources ,'css/XactlySMBStyles.css')}" />
    <style>
            
        body{
            margin: 0px !important;
            padding: 0px !important;
            min-width: 0;
            background-image:none;
            background-color:#FFFFFF;
        }

        .content {
            font-size: 11px;
            padding: 0px;
            margin: 20px;
            position:relative;
            overflow: hidden;
        }  
        
        a {
            text-decoration: none;
        }
        
        .btnAction {
            position: relative;
            overflow: hidden;
        }
        
        .btnAction .leftBtnOrange {
            background:url({!URLFOR($Resource.XactlySMBResources, 'img/buttons/orange_button_left.png')}) transparent  no-repeat scroll 0 0;
            float: left;
            height:19px;
            padding:0px 0px 0px 5px;
            width:auto;
        }
        .btnAction .middleBtnOrange {
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 3px 5px;
            width: auto;
        }
        .btnAction .rightBtnOrange {
            background: url({!URLFOR($Resource.XactlySMBResources, 'img/buttons/orange_button_right.png')}) transparent no-repeat scroll right center;
            float:left;
            height:19px;
            padding:0px 5px 0px 0px;
            width:auto;
            margin-top: 1px;
            margin-left: 5px;
        }  
        
        .searchLabel {
            /*float: left;*/
            font-size: 12px;
            font-weight: bold;
            margin-top: 2px;
            margin-right: 5px;
        }
        
        .header {
            background: url({!URLFOR($Resource.XactlySMBResources, 'img/layout/SearchBackgroundHeader.jpg')}) white repeat-x;
            height: 28px;
            margin: 0px;
            padding: 0px;
            width:100%;
            position:relative;
        }
        
        .topBorder {
            background: url({!URLFOR($Resource.XactlySMBResources, 'img/layout/SearchBackgroundTopBorder.jpg')}) white repeat-x;
            height: 9px;
            margin: 0px;
            padding: 0px;
        }
        
        .bottomBorder {
            background: url({!URLFOR($Resource.XactlySMBResources, 'img/layout/SearchBackgroundBottomBorder.jpg')}) white repeat-x;
            height: 4px;
            padding: 0px;
            bottom: 69px;
            right: 20px;
            left: 20px;
        }
        
        .xactlyLogo {
            background: url({!URLFOR($Resource.XactlySMBResources, 'img/layout/SearchXactlyLogo.png')}) white no-repeat right bottom;
            height: 59px;
            width: 100%;
            margin: 0px;
            padding: 0px;
            bottom: 10px;
            right: 20px;
        }
        
        .resultPanel {
            overflow:auto;
            height:300px;
        }
    </style>
    <div class="header"></div>
    <div class="content">
        <apex:form >
            <apex:outputpanel styleclass="btnAction" layout="block">
                <div style="float:left;margin:5px;">
                    <span class="searchLabel">{!$Label.Search} : </span>
                    <apex:inputText value="{!searchCriteria}" id="criteria"/>
                </div>
                
                <apex:outputPanel layout="block" onmouseover="btnSilverOver(this);" onmouseout="btnSilverOut(this);" onclick="validateCriteriaLength('{!$Component.criteria}');">
                     <apex:outputPanel layout="inline" styleClass="btn_silver">
                         <apex:outputPanel layout="inline" styleClass="btn_silver_r">
                             <apex:outputText styleClass="a_btn_silver a_btn_silver_gray" value="{!$Label.xactlyexpress__Go}" />
                         </apex:outputPanel>                                             
                     </apex:outputPanel>
                 </apex:outputPanel>
                
            </apex:outputpanel>
            <br />
            <br />
            <apex:outputPanel id="goToPage1" layout="block">
                <apex:outputPanel layout="block" rendered="{!noRows}">
                    {!$Label.xactlyexpress__GoToPage}
                    <apex:selectList size="1" value="{!currentPage}" multiSelect="false" onchange="goToPage();" id="pageSelect1">
                          <apex:selectOptions value="{!pagesOptions}" />
                    </apex:selectList>
                </apex:outputPanel>
            </apex:outputPanel>
            <div class="topBorder"></div>
            <apex:outputpanel styleclass="resultPanel" layout="block" id="resultPanel">
                <apex:outputpanel id="noResults" rendered="{!IF(searchResultCount == 0, true, false)}">
                    <apex:outputtext value="{!$Label.xactlyexpress__NoResultCriteria}">
                        <apex:param value="Products" />
                    </apex:outputtext>
                    <strong>{!searchCriteria}</strong>
                </apex:outputpanel>
                
                <apex:outputpanel id="results" rendered="{!IF(searchResultCount > 0, true, false)}">
                    <apex:repeat value="{!searchResult}" var="iter">
                        <a href="javascript:;" onclick='selectProduct("{!JSENCODE(iter.id)}","{!JSENCODE(iter.name)}");'>
                            <apex:outputtext value="{!iter.Name}" />
                        </a>
                        <br />
                    </apex:repeat>
                </apex:outputpanel>
                <br />
                <apex:outputpanel id="limitOfResults" rendered="{!IF(searchResultCount == 200, true, false)}">
                    {!$Label.xactlyexpress__SearchLimitExceded}
                </apex:outputpanel>
            </apex:outputpanel>
            <div class="bottomBorder"></div>
            <div class="xactlyLogo"></div>
            <apex:actionFunction name="searchProducts" action="{!searchProducts}" rerender="resultPanel,goToPage1" />
            <apex:actionFunction name="goToPage" action="{!goToPage}" rerender="resultPanel" oncomplete="waitOff();"/>
        </apex:form>
    </div>    
    <input type="hidden" value="{!JSENCODE(dealIndex)}" id="dealIndex" />
    <input type="hidden" value="{!onFilter}" id="onFilter" />
    <input type="hidden" value="{!JSENCODE(onManageDeals)}" id="onManageDeals" />
    
    <input type="hidden" value="{!$Label.SearchCriteriaShort}" id="SearchCriteriaShortLabel" />
    <script type="text/javascript" language="javascript" src="{!URLFOR($Resource.XactlySMBResources, 'js/XactlySMBJavascript.js')}"></script>
    <script>
        var XactlySMBProductPopup={
            SearchCriteriaShortLabel:jQuery('#SearchCriteriaShortLabel').val(),
            dealIndex:jQuery('#dealIndex').val(),
            dealIndex:jQuery('#dealIndex').val(),
            onFilter:evalStringBoolean(jQuery('#onFilter').val()),
            onManageDeals:jQuery('#onManageDeals').val(),
        }    
        jQuery(document).ready(
            function(){
                setTimeout("loadAnltc('XactlySMBProductPopup.php')", 1000);
            }        
        );
        function validateCriteriaLength (criteriaInput) {
            var criteriaInput = document.getElementById(criteriaInput);
            var result = true;
            if (criteriaInput != null) {
                var criteriaValue = criteriaInput.value;
                criteriaValue = criteriaValue.replace(/\s/gi, '');
                criteriaValue = criteriaValue.replace(/\*/gi, '')
                if (criteriaValue.length < 2) {
                    alert(XactlySMBProductPopup.SearchCriteriaShortLabel);
                    result = false;
                }
            }   
            if (result) {
                searchProducts();
            } 
        }
        
        
        function selectProduct (productId, productName) {
            if (XactlySMBProductPopup.onFilter) {
                window.opener.document.getElementById(XactlySMBProductPopup.dealIndex + '-productFilter').getElementsByTagName('input')[0].value = productName;
                if( window.opener.document.getElementById(XactlySMBProductPopup.dealIndex + '-productFilter').getElementsByTagName('input')[1] != undefined){
                    window.opener.document.getElementById(XactlySMBProductPopup.dealIndex + '-productFilter').getElementsByTagName('input')[1].value = productId;
                    window.opener.document.getElementById(XactlySMBProductPopup.dealIndex + '-accountFilter').getElementsByTagName('input')[0].value = productName;
                    window.opener.document.getElementById(XactlySMBProductPopup.dealIndex + '-accountFilter').getElementsByTagName('input')[1].value = productId;
                }else{
                    window.opener.myJQuery('.' + XactlySMBProductPopup.dealIndex + '-productId')[0].value = productId;
                }
            }
            else {
                window.opener.document.getElementById(XactlySMBProductPopup.dealIndex + '-product').getElementsByTagName('input')[0].value = productName;
                if( window.opener.document.getElementById(XactlySMBProductPopup.dealIndex + '-product').getElementsByTagName('input')[1] != undefined){
                    window.opener.document.getElementById(XactlySMBProductPopup.dealIndex + '-product').getElementsByTagName('input')[1].value = productId;
                }else{
                    window.opener.myJQuery('.' + XactlySMBProductPopup.dealIndex + '-productId')[0].value = productId;
                }             
                if(XactlySMBProductPopup.onManageDeals == 'dls'){
                    window.opener.changeProduct(XactlySMBProductPopup.dealIndex);
                }       
            }
            window.close(); 
        }
    </script>
</apex:page>